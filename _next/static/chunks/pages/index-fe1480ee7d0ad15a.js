(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2871)}])},1210:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDomainLocale=function(e,t,n,o){return!1},("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8418:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(2648).Z,r=n(7273).Z,a=o(n(7294)),l=n(3297),i=n(4634),s=n(4611),c=n(3794),u=n(2725),d=n(3462),f=n(1018),p=n(7190),h=n(1210),g=n(8684);let m=new Set;function y(e,t,n,o,r){if(r||i.isLocalURL(t)){if(!o.bypassPrefetchedCheck){let r=void 0!==o.locale?o.locale:"locale"in e?e.locale:void 0,a=t+"%"+n+"%"+r;if(m.has(a))return;m.add(a)}Promise.resolve(e.prefetch(t,n,o)).catch(e=>{})}}function v(e){return"string"==typeof e?e:s.formatUrl(e)}let b=a.default.forwardRef(function(e,t){let n,o;let{href:s,as:m,children:b,prefetch:_,passHref:w,replace:j,shallow:C,scroll:x,locale:O,onClick:k,onMouseEnter:P,onTouchStart:E,legacyBehavior:M=!1}=e,T=r(e,["href","as","children","prefetch","passHref","replace","shallow","scroll","locale","onClick","onMouseEnter","onTouchStart","legacyBehavior"]);n=b,M&&("string"==typeof n||"number"==typeof n)&&(n=a.default.createElement("a",null,n));let N=!1!==_,S=a.default.useContext(d.RouterContext),L=a.default.useContext(f.AppRouterContext),I=null!=S?S:L,B=!S,{href:z,as:R}=a.default.useMemo(()=>{if(!S){let e=v(s);return{href:e,as:m?v(m):e}}let[e,t]=l.resolveHref(S,s,!0);return{href:e,as:m?l.resolveHref(S,m):t||e}},[S,s,m]),A=a.default.useRef(z),H=a.default.useRef(R);M&&(o=a.default.Children.only(n));let U=M?o&&"object"==typeof o&&o.ref:t,[D,G,K]=p.useIntersection({rootMargin:"200px"}),W=a.default.useCallback(e=>{(H.current!==R||A.current!==z)&&(K(),H.current=R,A.current=z),D(e),U&&("function"==typeof U?U(e):"object"==typeof U&&(U.current=e))},[R,U,z,K,D]);a.default.useEffect(()=>{I&&G&&N&&y(I,z,R,{locale:O},B)},[R,z,G,O,N,null==S?void 0:S.locale,I,B]);let q={ref:W,onClick(e){M||"function"!=typeof k||k(e),M&&o.props&&"function"==typeof o.props.onClick&&o.props.onClick(e),I&&!e.defaultPrevented&&function(e,t,n,o,r,l,s,c,u,d){let{nodeName:f}=e.currentTarget,p="A"===f.toUpperCase();if(p&&(function(e){let t=e.currentTarget,n=t.getAttribute("target");return n&&"_self"!==n||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)||!u&&!i.isLocalURL(n)))return;e.preventDefault();let h=()=>{"beforePopState"in t?t[r?"replace":"push"](n,o,{shallow:l,locale:c,scroll:s}):t[r?"replace":"push"](o||n,{forceOptimisticNavigation:!d})};u?a.default.startTransition(h):h()}(e,I,z,R,j,C,x,O,B,N)},onMouseEnter(e){M||"function"!=typeof P||P(e),M&&o.props&&"function"==typeof o.props.onMouseEnter&&o.props.onMouseEnter(e),I&&(N||!B)&&y(I,z,R,{locale:O,priority:!0,bypassPrefetchedCheck:!0},B)},onTouchStart(e){M||"function"!=typeof E||E(e),M&&o.props&&"function"==typeof o.props.onTouchStart&&o.props.onTouchStart(e),I&&(N||!B)&&y(I,z,R,{locale:O,priority:!0,bypassPrefetchedCheck:!0},B)}};if(c.isAbsoluteUrl(R))q.href=R;else if(!M||w||"a"===o.type&&!("href"in o.props)){let e=void 0!==O?O:null==S?void 0:S.locale,t=(null==S?void 0:S.isLocaleDomain)&&h.getDomainLocale(R,e,null==S?void 0:S.locales,null==S?void 0:S.domainLocales);q.href=t||g.addBasePath(u.addLocale(R,e,null==S?void 0:S.defaultLocale))}return M?a.default.cloneElement(o,q):a.default.createElement("a",Object.assign({},T,q),n)});t.default=b,("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7190:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.useIntersection=function(e){let{rootRef:t,rootMargin:n,disabled:s}=e,c=s||!a,[u,d]=o.useState(!1),f=o.useRef(null),p=o.useCallback(e=>{f.current=e},[]);o.useEffect(()=>{if(a){if(c||u)return;let e=f.current;if(e&&e.tagName){let o=function(e,t,n){let{id:o,observer:r,elements:a}=function(e){let t;let n={root:e.root||null,margin:e.rootMargin||""},o=i.find(e=>e.root===n.root&&e.margin===n.margin);if(o&&(t=l.get(o)))return t;let r=new Map,a=new IntersectionObserver(e=>{e.forEach(e=>{let t=r.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)})},e);return t={id:n,observer:a,elements:r},i.push(n),l.set(n,t),t}(n);return a.set(e,t),r.observe(e),function(){if(a.delete(e),r.unobserve(e),0===a.size){r.disconnect(),l.delete(o);let e=i.findIndex(e=>e.root===o.root&&e.margin===o.margin);e>-1&&i.splice(e,1)}}}(e,e=>e&&d(e),{root:null==t?void 0:t.current,rootMargin:n});return o}}else if(!u){let e=r.requestIdleCallback(()=>d(!0));return()=>r.cancelIdleCallback(e)}},[c,n,t,u,f.current]);let h=o.useCallback(()=>{d(!1)},[]);return[p,u,h]};var o=n(7294),r=n(9311);let a="function"==typeof IntersectionObserver,l=new Map,i=[];("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2871:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var o=n(5893),r=n(9008),a=n.n(r),l=n(6618),i=n.n(l),s=n(7294);async function c(e,t){let n=new FormData;n.append("file",t,"audio.webm"),n.append("model","whisper-1");let o=await fetch("https://api.openai.com/v1/audio/transcriptions",{method:"POST",headers:{Authorization:"Bearer "+e},body:n}),r=await o.json();return r.text}async function u(e,t,n){let o=[{role:"system",content:"短文で会話してください"},...t,{role:"user",content:n}],r={method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e},body:JSON.stringify({model:"gpt-3.5-turbo",messages:o})},a=await fetch("https://api.openai.com/v1/chat/completions",r),l=await a.json();return console.log(l),l.choices[0].message.content}let d=async(e,t,n)=>{let o=await fetch("https://texttospeech.googleapis.com/v1/text:synthesize?key=".concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({input:{text:n},voice:{languageCode:t.substring(0,5),name:t},audioConfig:{audioEncoding:"OGG_OPUS"}})}),r=await o.json();return new Promise(e=>{let t=new Audio("data:audio/ogg;base64,".concat(r.audioContent));t.play(),t.addEventListener("ended",()=>{e()})})};var f=n(8193),p=n(1664),h=n.n(p);let g=e=>{switch(e){case"notInitialized":return"最初に押してね";case"idle":return"話す";case"recording":return"録音中";case"callWhisper":return"Whisper呼び出し中";case"callChatGPT":return"ChatGPT呼び出し中";case"speaking":return"話しています"}};function m(){let[e,t]=(0,s.useState)("notInitialized"),[n,r]=(0,s.useState)([]),l=(0,s.useRef)(),p=(0,s.useCallback)(async()=>{if("notInitialized"===e){let e=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new MediaRecorder(e,{mimeType:"audio/webm"});l.current=n,t("idle");return}if("recording"===e){l.current.stop();return}if("idle"!==e)return;t("recording");let o=await navigator.mediaDevices.getUserMedia({audio:!0}),a=new MediaRecorder(o,{mimeType:"audio/webm"});l.current=a,a.start();let i=[];a.addEventListener("dataavailable",e=>{i.push(e.data)}),a.addEventListener("stop",async()=>{let e=localStorage.getItem("openAiApiKey"),o=localStorage.getItem("googleApiKey"),a=localStorage.getItem("googleVoice");if(!e||!o||!a){alert("設定がされていません"),t("idle");return}if(i[0].size<5e3){t("idle");return}let l=new Blob(i);t("callWhisper");let s=await c(e,l);if(!s){t("idle");return}console.log(s),t("callChatGPT");let f=await u(e,n,s);r([...n,{role:"user",content:s},{role:"assistant",content:f}]),t("speaking"),await d(o,a,f),t("idle")})},[n,e]);return(0,s.useEffect)(()=>{let e=document.querySelector("."+i().dialogLog);e.scrollTop=e.scrollHeight},[n]),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(a(),{children:[(0,o.jsx)("title",{children:"AI Voice Chat"}),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,o.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,o.jsxs)("main",{className:i().container,children:[(0,o.jsx)("header",{className:i().header,children:(0,o.jsx)("h1",{className:i().title,children:"ChatGPT"})}),(0,o.jsx)("div",{className:i().dialogLog,children:(0,o.jsx)("table",{children:(0,o.jsx)("tbody",{children:n.map((e,t)=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e.role}),(0,o.jsx)("td",{children:e.content})]},t))})})}),(0,o.jsxs)("div",{className:i().speakButtonContainer,children:[(0,o.jsx)("button",{className:i().speakButton,onClick:p,children:g(e)}),(0,o.jsx)(h(),{href:"/setting",children:(0,o.jsx)("button",{className:i().settingButton,children:(0,o.jsx)(f.xRF,{size:48})})})]})]})]})}},6618:function(e){e.exports={container:"Home_container__97eC3",header:"Home_header__CyQ_T",dialogLog:"Home_dialogLog__qLM_v",speakButtonContainer:"Home_speakButtonContainer__5ztZM",speakButton:"Home_speakButton__MuPTB",settingButton:"Home_settingButton__PioYM"}},9008:function(e,t,n){e.exports=n(5443)},1664:function(e,t,n){e.exports=n(8418)},8357:function(e,t,n){"use strict";n.d(t,{w_:function(){return s}});var o=n(7294),r={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},a=o.createContext&&o.createContext(r),l=function(){return(l=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},i=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&0>t.indexOf(o)&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)0>t.indexOf(o[r])&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n};function s(e){return function(t){return o.createElement(c,l({attr:l({},e.attr)},t),function e(t){return t&&t.map(function(t,n){return o.createElement(t.tag,l({key:n},t.attr),e(t.child))})}(e.child))}}function c(e){var t=function(t){var n,r=e.attr,a=e.size,s=e.title,c=i(e,["attr","size","title"]),u=a||t.size||"1em";return t.className&&(n=t.className),e.className&&(n=(n?n+" ":"")+e.className),o.createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,c,{className:n,style:l(l({color:e.color||t.color},t.style),e.style),height:u,width:u,xmlns:"http://www.w3.org/2000/svg"}),s&&o.createElement("title",null,s),e.children)};return void 0!==a?o.createElement(a.Consumer,null,function(e){return t(e)}):t(r)}}},function(e){e.O(0,[617,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);